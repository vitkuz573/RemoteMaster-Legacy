@page "/Admin/SignInJournal"

@rendermode InteractiveServer

@namespace RemoteMaster.Server.Components.Admin.Pages.Manage

@inject IServiceScopeFactory ScopeFactory

<PageTitle>SignIn Journal</PageTitle>

<div class="overflow-x-auto p-4">
    <div class="mb-4 flex items-center justify-between">
        <div class="flex items-center">
            <label class="mr-2">Items per page:</label>
            <select class="rounded border border-gray-300 px-2 py-1" @bind="PageSize">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="20">20</option>
            </select>
        </div>
        <div class="flex items-center">
            <label class="mr-2">Filter:</label>
            <input type="text" class="rounded border border-gray-300 px-2 py-1" @bind="Filter" />
        </div>
    </div>

    <table class="min-w-full border-collapse border border-gray-300 bg-white shadow-lg">
        <thead>
            <tr class="bg-gray-200">
                <th class="border-b-2 cursor-pointer border-gray-300 px-6 py-3 text-left text-sm uppercase tracking-wider text-gray-600" @onclick='() => SortByColumn("User")'>
                    User @GetSortIcon("User")
                </th>
                <th class="border-b-2 cursor-pointer border-gray-300 px-6 py-3 text-left text-sm uppercase tracking-wider text-gray-600" @onclick='() => SortByColumn("SignInTime")'>
                    Sign-In Time @GetSortIcon("SignInTime")
                </th>
                <th class="border-b-2 cursor-pointer border-gray-300 px-6 py-3 text-left text-sm uppercase tracking-wider text-gray-600" @onclick='() => SortByColumn("Success")'>
                    Success @GetSortIcon("Success")
                </th>
                <th class="border-b-2 cursor-pointer border-gray-300 px-6 py-3 text-left text-sm uppercase tracking-wider text-gray-600" @onclick='() => SortByColumn("IpAddress")'>
                    IP Address @GetSortIcon("IpAddress")
                </th>
            </tr>
        </thead>
        <tbody class="bg-white">
            @foreach (var entry in PagedEntries)
            {
                <tr class="hover:bg-gray-100">
                    <td class="whitespace-no-wrap border-b border-gray-300 px-6 py-4">@entry.User.UserName</td>
                    <td class="whitespace-no-wrap border-b border-gray-300 px-6 py-4">@entry.SignInTime.ToLocalTime()</td>
                    <td class="whitespace-no-wrap border-b border-gray-300 px-6 py-4">@(entry.IsSuccessful ? "Yes" : "No")</td>
                    <td class="whitespace-no-wrap border-b border-gray-300 px-6 py-4">@entry.IpAddress</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="mt-4 flex items-center justify-between">
        <button class="rounded bg-gray-300 px-4 py-2" @onclick="PreviousPage" disabled="@(!HasPreviousPage)">Previous</button>
        <span>Page @CurrentPage of @TotalPages</span>
        <button class="rounded bg-gray-300 px-4 py-2" @onclick="NextPage" disabled="@(!HasNextPage)">Next</button>
    </div>

    <button class="mt-4 rounded bg-red-500 px-4 py-2 text-white" @onclick="ClearJournal">Clear Journal</button>
</div>

@if (!_signInJournalEntries.Any())
{
    <p class="mt-6 text-center text-gray-500">No sign-in attempts recorded.</p>
}
