@using Microsoft.AspNetCore.Identity
@using RemoteMaster.Server.Data
@using RemoteMaster.Shared.Abstractions
@inject NavigationManager NavigationManager
@inject IHostInformationService HostInformationService
@inject IJSRuntime JsRuntime
@inject UserManager<ApplicationUser> UserManager
@inject ApplicationDbContext DbContext
@inject AuthenticationStateProvider AuthenticationStateProvider

<MudDialog>
    <DialogContent>
        <EditForm Model="@_model" OnValidSubmit="OnValidSubmit">
            <DataAnnotationsValidator />
            <MudCardContent>
                <MudExpansionPanels>
                    <MudExpansionPanel Text="Main Parameters">
                        <MudTextField Label="Server" @bind-Value="_model.Server" For="@(() => _model.Server)" ReadOnly="true" />
                    </MudExpansionPanel>

                    <MudExpansionPanel Text="Subject Parameters">
                        <MudTextField Label="Organization" @bind-Value="_model.Subject.Organization" For="@(() => _model.Subject.Organization)" ReadOnly />
                        <MudTextField Label="Organizational Unit" @bind-Value="_organizationalUnitInput" />
                        <MudTextField Label="Locality" @bind-Value="_model.Subject.Locality" For="@(() => _model.Subject.Locality)"/>
                        <MudTextField Label="State" @bind-Value="_model.Subject.State" For="@(() => _model.Subject.State)"/>
                        <MudSelect T="string" Label="Country" @bind-Value="_model.Subject.Country" Dense="true">
                            @foreach (var country in _countries)
                            {
                                <MudSelectItem T="string" Value="@country.Value">@country.Key</MudSelectItem>
                            }
                        </MudSelect>
                    </MudExpansionPanel>
                </MudExpansionPanels>
            </MudCardContent>

            <MudCardActions>
                <MudButton ButtonType="ButtonType.Submit" Color="Color.Primary">Download Configuration</MudButton>
                <MudButton Color="Color.Secondary" OnClick="DownloadHost">Download Host</MudButton>
            </MudCardActions>
        </EditForm>
    </DialogContent>
</MudDialog>
