@using Microsoft.AspNetCore.Identity
@using RemoteMaster.Shared.Abstractions
@using RemoteMaster.Server.Abstractions
@using RemoteMaster.Server.Aggregates.ApplicationUserAggregate

@inject IHostInformationService HostInformationService
@inject IJSRuntime JsRuntime
@inject UserManager<ApplicationUser> UserManager
@inject ICountryProvider CountryProvider
@inject HttpClient HttpClient

<MudDialog>
    <DialogContent>
        <EditForm Model="@_model" OnValidSubmit="OnValidSubmit">
            <DataAnnotationsValidator />
            <MudCardContent>
                <MudExpansionPanels>
                    <MudExpansionPanel Text="Main Parameters">
                        <MudTextField Label="Server" @bind-Value="_model.Server" For="@(() => _model.Server)" ReadOnly="true" />
                    </MudExpansionPanel>

                    <MudExpansionPanel Text="Subject Parameters">
                        <MudSelect Label="Organization" Value="_selectedOrganization" T="string?" ValueChanged="OrganizationChanged" Dense>
                            @foreach (var organization in _organizations)
                            {
                                <MudSelectItem Value="@organization.Name">@organization.Name</MudSelectItem>
                            }
                        </MudSelect>

                        <MudSelect Label="Organizational Unit" Value="_selectedOrganizationalUnit" T="string?" ValueChanged="OrganizationalUnitChanged" Dense Disabled="@string.IsNullOrEmpty(_selectedOrganization)">
                            @foreach (var unit in _organizationalUnits)
                            {
                                <MudSelectItem Value="@unit.Name">@unit.Name</MudSelectItem>
                            }
                        </MudSelect>
                    </MudExpansionPanel>
                </MudExpansionPanels>
            </MudCardContent>

            <MudCardActions>
                <MudButton ButtonType="ButtonType.Submit" Color="Color.Primary">Download Configuration</MudButton>
                <MudButton Color="Color.Secondary" OnClick="DownloadHost">Download Host</MudButton>
            </MudCardActions>
        </EditForm>
    </DialogContent>
</MudDialog>
