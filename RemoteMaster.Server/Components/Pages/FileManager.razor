@page "/{Host}/filemanager"
@rendermode InteractiveServer
@attribute [Authorize]
@using Microsoft.AspNetCore.Authorization
@using RemoteMaster.Shared.Models

<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="_theme" />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudToolBar>
        <InputFile OnChange="@OnInputFileChange" />
        <MudTextField @bind-Value="@_destinationPath" Label="Destination Path" />
        <MudButton OnClick="@UploadFile" Color="Color.Primary" Variant="Variant.Filled">Upload</MudButton>
    </MudToolBar>

    <MudTable Items="@_fileSystemItems" Dense="true" Hover="true" Filter="new Func<FileSystemItem, bool>(FilterFunc1)">
        <ToolBarContent>
            <MudText Typo="Typo.h6">File Manager</MudText>

            <MudSpacer />

            <MudSelect T="string" Label="Select Drive" ValueChanged="OnDriveSelected" Class="w-2">
                @foreach (var drive in _availableDrives)
                {
                    <MudSelectItem Value="@drive" />
                }
            </MudSelect>

            <MudSpacer />

            <MudTextField @bind-Value="@_currentPath" Label="Path" AdornmentIcon="@Icons.Material.Filled.Folder" />
            <MudButton OnClick="@NavigateToPath" Color="Color.Primary" Variant="Variant.Filled" Class="mt-4 ms-2">Navigate</MudButton>
            
            <MudSpacer />
            
            <MudTextField @bind-Value="_searchQuery" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
        </ToolBarContent>
        <HeaderContent>
            <MudTh>
                <MudTableSortLabel SortBy="new Func<FileSystemItem, object>(x => x.Name)">
                    Name
                </MudTableSortLabel>
            </MudTh>
            <MudTh>
                <MudTableSortLabel SortBy="new Func<FileSystemItem, object>(x => x.Type)">
                    Type
                </MudTableSortLabel>
            </MudTh>
            <MudTh>
                <MudTableSortLabel SortBy="new Func<FileSystemItem, object>(x => x.Size)">
                    Size
                </MudTableSortLabel>
            </MudTh>
        </HeaderContent>
        <RowTemplate Context="context">
            <MudTd DataLabel="Item">
                <MudButton OnClick="@(() => HandleClick(context))" Class="text-left p-0" Style="text-transform: none;">
                    <MudIcon Icon="@GetIcon(context.Type)" Class="mr-2" />
                    @context.Name
                </MudButton>
            </MudTd>
            <MudTd DataLabel="Type">@context.Type</MudTd>
            <MudTd DataLabel="Size">@FormatSize(context.Size)</MudTd>
        </RowTemplate>
    </MudTable>
</MudLayout>