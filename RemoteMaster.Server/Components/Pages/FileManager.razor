@page "/{Host}/filemanager"

@using RemoteMaster.Server.Abstractions
@using RemoteMaster.Shared.Models

@rendermode InteractiveServer

@inject IJSRuntime JsRuntime
@inject IAccessTokenProvider AccessTokenProvider

<PageTitle>File Manager</PageTitle>

<div class="min-h-screen bg-gray-100 p-4 sm:p-6">
    <div class="mx-auto max-w-7xl">
        <div class="mb-4 flex flex-col space-y-4 sm:flex-row sm:justify-between sm:space-y-0">
            <div class="flex flex-col items-center space-y-2 sm:flex-row sm:space-y-0 sm:space-x-4">
                <InputFile OnChange="@OnInputFileChange" />
                <button @onclick="UploadFile" class="h-10 w-32 rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 focus:outline-none sm:w-auto">
                    Upload
                </button>
                <select @onchange="OnDriveSelected" class="h-10 rounded-md border border-gray-300 bg-white px-3 py-2 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    @foreach (var drive in _availableDrives)
                    {
                        <option value="@drive">@drive</option>
                    }
                </select>
                <InputText @bind-Value="_currentPath" placeholder="Path" class="h-10 w-64 rounded-md border border-gray-300 bg-white px-3 py-2 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:w-auto" />
                <button @onclick="NavigateToPath" class="h-10 w-32 rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 focus:outline-none sm:w-auto">
                    Navigate
                </button>
            </div>
            <div class="flex flex-col items-center space-y-2 sm:flex-row sm:space-y-0 sm:space-x-4 sm:ml-auto">
                <InputText @bind-Value="_searchQuery" placeholder="Search" class="h-10 w-80 rounded-md border border-gray-300 bg-white px-3 py-2 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:w-auto" @oninput="UpdateSearchQuery" />
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full overflow-hidden rounded-md bg-white shadow">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                            Name
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                            Type
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                            Size
                        </th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 bg-white">
                    @foreach (var item in _fileSystemItems)
                    {
                        <tr>
                            <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-900">
                                <div class="flex items-center space-x-2">
                                    <button @onclick="() => HandleClick(item)" class="flex items-center space-x-2 p-0 hover:underline focus:outline-none">
                                        @if (item.Type == FileSystemItem.FileSystemItemType.Directory)
                                        {
                                            <span class="material-icons">folder</span>
                                        }
                                        else
                                        {
                                            <span class="material-icons">insert_drive_file</span>
                                        }
                                        <span class="hover:no-underline">@item.Name</span>
                                    </button>
                                </div>
                            </td>
                            <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-900">@item.Type</td>
                            <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-900">@FormatSize(item.Size)</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
